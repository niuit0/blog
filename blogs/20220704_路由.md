# 路由

## 路由的基本原理

### 路由的来源

- 直连路由：自动发现
- 静态路由：管理员手动配置
- 动态路由：通过路由协议交换路由信息获取

### 路由的优先级（管理距离/AD）

人为定义的一个值，5用于判断路由来源的可信任程度。取值范围：0 - 255，值越小，可信度越高。

华为设备默认路由外部优先级：

| 路由类型 | 优先级 | 能否更改 |
| -- | -- | -- |
| 直连路由 | 0 | N |
| 静态路由 | 60 | Y |
| RIP | 100 | Y |
| OSPF | 10 | Y |
| OSPF_ASE | 150 | Y |
| ISIS | 15 | Y |
| BGP | 255 | Y |

除了直连路由之外，其他协议的优先级都可更改。

当去往相同目的网段有多种协议的路径可供选择的时候，选择路由优先级值小的，代表可信任程度更高。

当遇到相同目的网段时，不同路由协议的优先级配置相同，设备会比较路由协议的内部优先级（不可更改）。

### 路由开销（Cost/Metric）

### 路由标记（Route Flags）

- R：表示该路由是迭代路由
- D：表示该路由下发到FIB表
- T：表示下一跳是VPN实例

### 最长匹配原则

当路由器收到应该IP数据包时，会将数据包的目的IP地址与自己本地路由表中的所有路由表项进行逐位（Bit-By-Bit）比对，直到找到匹配度最长的条目，这就是最长前缀匹配机制。

### 路由进表的规则

1. 通过路由优先级选出最信任的路由来源。
2. 在最信任的路由来源中选择COST值最小的加入到路由表中。

### 路由表报文转发机制

根据IP报文目的地址查路由表，找到最匹配的路由（即掩码长度最长的进行转发。

## 路由协议

### 分类

#### 从工作原理上分类

1. DV距离矢量路由协议：RIPv1、RIPv2、IGRP（思科私有，已淘汰）
2. LS链路状态路由协议：OSPFv2(IPv4)、OSPFv3(IPv6)、ISIS
3. 路径矢量路由协议：BGP
4. 混合型路由协议/高级的距离矢量（DV/LS）：EIGRP（思科）

#### 从工作范围上分类

1. IGP（内部网关路由协议，实现AS内部互联互通的路由协议）：RIPv1、RIPv2、IGRP、EIGRP、OSPFv2、OSPFv3
2. EGP（外部网关路由协议，实现AS之间互联互通的路由协议）：BGP
3. AS（自治系统）：运行相同的IGP协议的设备所组成的网络